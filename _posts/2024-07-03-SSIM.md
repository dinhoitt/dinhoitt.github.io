---
layout: post
title:  "SSIM for color"
date:   2024-07-03T10:08:52+09:00
author: DINHO
categories:
  - Python
  - ì‹ í˜¸-ì²˜ë¦¬-ì´ë¡ 
cover:  "/assets/post/ssim.png"
---

ì˜¤ëŠ˜ì€ SSIM(Structural Similarity Index Measure)ì— ëŒ€í•´ì„œ ì´ì•¼ê¸° í•´ë³´ê² ìŠµë‹ˆë‹¤. SSIMì€ ë””ì§€í„¸ TV, ì‚¬ì§„, ë¹„ë””ì˜¤ ë“±ì˜ ì¸ì§€ëœ í’ˆì§ˆì„ ì˜ˆì¸¡í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤. ì´ ë°©ë²•ì€ ë‘ ì´ë¯¸ì§€ ê°„ì˜ ìœ ì‚¬ì„±ì„ ì¸¡ì •í•˜ëŠ” ë°ì—ë„ ì‚¬ìš©ë¼ì„œ ìƒì„±í˜• AIì—ì„œëŠ” ì›ë³¸ ì´ë¯¸ì§€ì™€ ìƒì„± ì´ë¯¸ì§€ë¥¼ ë¹„êµí•˜ê¸° ìœ„í•´ SSIMì„ í‰ê°€ì§€í‘œë¡œ ì‚¬ìš©í•˜ê¸°ë„ í•©ë‹ˆë‹¤.

SSIMì€ ë‘ í”½ì…€ ê°’ì˜ ì°¨ì´ë¡œ ìœ ì‚¬ë„ë¥¼ ê³„ì‚°í•©ë‹ˆë‹¤. ì œê°€ ê²€ìƒ‰í•´ ë´¤ì„ ë•Œ(ì €ì˜ ê²€ìƒ‰ ì‹¤ë ¥ì´ ì•ˆ ì¢‹ì€ ê±´ì§€ ëª¨ë¥´ê² ì§€ë§Œ,,,) ì»¬ëŸ¬ ì´ë¯¸ì§€ì— ëŒ€í•œ SSIM ì½”ë“œëŠ” ì—†ë”ë¼ê³ ìš”... í‘ë°± ì´ë¯¸ì§€ì— ëŒ€í•œ SSIM ì½”ë“œë“¤ì€ ë§ì•„ì„œ ì´ë²ˆì— ì§ì ‘ ì´ë¡ ê³¼ ìˆ˜ì‹ì„ ë°”íƒ•ìœ¼ë¡œ ì½”ë“œë¥¼ ë§Œë“¤ì–´ ë³´ì•˜ìŠµë‹ˆë‹¤.

SSIMì˜ ì£¼ìš” ìš”ì†ŒëŠ” ì„¸ ê°€ì§€ ì…ë‹ˆë‹¤.

1. __ë°ê¸°(Luminance)__ : ë‘ ì´ë¯¸ì§€ì˜ í‰ê·  ë°ê¸° ë¹„êµ

2. __ëŒ€ë¹„(Contrast)__ : ë‘ ì´ë¯¸ì§€ì˜ ëŒ€ë¹„ ë¹„êµ

3. __êµ¬ì¡°(Structure)__ ë‘ ì´ë¯¸ì§€ì˜ êµ¬ì¡° ë¹„êµ

SSIM ê³„ì‚°ì€ ì•„ë˜ì™€ ê°™ì€ ìˆ˜ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.

$$\text{SSIM}(x, y) = \frac{(2\mu_x \mu_y + C_1)(2\sigma_{xy} + C_2)}{(\mu_x^2 + \mu_y^2 + C_1)(\sigma_x^2 + \sigma_y^2 + C_2)}$$

ì—¬ê¸°ì„œ,
- \( x \)ì™€ \( y \)ëŠ” ë¹„êµí•  ë‘ ì´ë¯¸ì§€ì˜ ì°½(window)ì…ë‹ˆë‹¤.
- \( \mu_x \)ì™€ \( \mu_y \)ëŠ” ê°ê° \( x \)ì™€ \( y \)ì˜ í‰ê·  ë°ê¸°ì…ë‹ˆë‹¤.
- \( \sigma_x \)ì™€ \( \sigma_y \)ëŠ” ê°ê° \( x \)ì™€ \( y \)ì˜ í‘œì¤€ í¸ì°¨ì…ë‹ˆë‹¤.
- \( \sigma_{xy} \)ëŠ” \( x \)ì™€ \( y \)ì˜ ê³µë¶„ì‚°ì…ë‹ˆë‹¤.
- \( C_1 \)ê³¼ \( C_2 \)ëŠ” ì•ˆì •í™”ë¥¼ ìœ„í•œ ìƒìˆ˜ì…ë‹ˆë‹¤.

SSIM ê°’ì€ -1ì—ì„œ 1 ì‚¬ì´ì˜ ê°’ì„ ê°€ì§€ë©°, 1ì— ê°€ê¹Œìš¸ìˆ˜ë¡ ë‘ ì´ë¯¸ì§€ê°€ ë” ìœ ì‚¬í•¨ì„ ì˜ë¯¸í•©ë‹ˆë‹¤. ì¼ë°˜ì ìœ¼ë¡œ SSIM ê°’ì´ 0.9 ì´ìƒì´ë©´ ë‘ ì´ë¯¸ì§€ê°€ ê±°ì˜ ë™ì¼í•˜ë‹¤ê³  ê°„ì£¼ë©ë‹ˆë‹¤.

SSIMì„ ì»¬ëŸ¬ ì´ë¯¸ì§€ì— ì ìš©í•˜ë ¤ë©´ ê° ìƒ‰ìƒ ì±„ë„, ì¦‰, RGBì±„ë„ì— ëŒ€í•œ SSIMì„ ê°ê° ê³„ì‚°í•˜ê³  í‰ê· ì„ êµ¬í•´ì£¼ë©´ ë©ë‹ˆë‹¤. ìˆ˜ì‹ì€ ì•„ë˜ì™€ ê°™ìŠµë‹ˆë‹¤.

$$\text{SSIM}_{r}(R_{1}, R_{2}), \text{SSIM}_{r}(G_{1}, G_{2}), \text{SSIM}_{r}(B_{1}, B_{2}),$$

$$\text{SSIM}_{rgb} = \frac{1}{3} \text{SSIM}_{r} + \frac{1}{3} \text{SSIM}_{g} + \frac{1}{3} \text{SSIM}_{b}$$

ì´ ìˆ˜ì‹ì„ Pythonì½”ë“œì™€ í•¨ê»˜ SSIMì„ ì ìš©í•´ë³´ê² ìŠµë‹ˆë‹¤.

ì•„ë˜ ì½”ë“œëŠ” ì œê°€ ìº¡ìŠ¤í†¤ ë””ìì¸ì„ ì§„í–‰í•˜ë©´ì„œ êµ¬ì„±í•œ ì½”ë“œì…ë‹ˆë‹¤. img1ì€ Ground Truth ë©œ-ìŠ¤í™íŠ¸ë¡œê·¸ë¨ ì´ë¯¸ì§€ì´ê³  img2,3,4ì™€ ssimì„ ë¹„êµí•˜ì—¬ ì–´ë–¤ GAN ëª¨ë¸ì´ ë©œ-ìŠ¤í™íŠ¸ë¡œê·¸ë¨ì„ ì˜ ë³µì›í–ˆëŠ”ì§€ë¥¼ í‰ê°€í•˜ê¸° ìœ„í•´ ì•„ë˜ ì½”ë“œë¥¼ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. MSE ê³„ì‚°ë„ ë“¤ì–´ê°€ ìˆì§€ë§Œ ë¬´ì‹œí•˜ì‹œë©´ ë©ë‹ˆë‹¤.

```python
import numpy as np
import matplotlib.pyplot as plt
import imageio.v2 as imageio
from skimage import img_as_float
from skimage.metrics import structural_similarity as ssim
from skimage.metrics import mean_squared_error
import os

# íŒŒì¼ ê²½ë¡œ ìˆ˜ì •
path1 = os.path.expanduser('C:\\capstone\\test4_origin.wav_mel_spectrogram.png')
path2 = os.path.expanduser('C:\\capstone\\test4_msdmpd_converted_generated.wav_mel_spectrogram.png')
path3 = os.path.expanduser('C:\\capstone\\test4_medmpdsnake_converted_generated.wav_mel_spectrogram.png')
path4 = os.path.expanduser('C:\\capstone\\test4_mrdmpd_converted_generated.wav_mel_spectrogram.png')

# ì´ë¯¸ì§€ ë¡œë“œ
img1 = img_as_float(imageio.imread(path1))
img2 = img_as_float(imageio.imread(path2))
img3 = img_as_float(imageio.imread(path3))
img4 = img_as_float(imageio.imread(path4))

# ì´ë¯¸ì§€ í¬ê¸° ì¡°ì •
min_rows = min(img1.shape[0], img2.shape[0], img3.shape[0], img4.shape[0])
min_cols = min(img1.shape[1], img2.shape[1], img3.shape[1], img4.shape[1])

img1 = img1[:min_rows, :min_cols]
img2 = img2[:min_rows, :min_cols]
img3 = img3[:min_rows, :min_cols]
img4 = img4[:min_rows, :min_cols]

# win_size ì„ íƒ
win_size = min(3, min_rows, min_cols) if min(min_rows, min_cols) >= 3 else 1

# SSIMê³¼ MSE ê³„ì‚°
def calculate_metrics(imgA, imgB):
    ssim_total = 0
    mse_total = 0
    for i in range(3):  # RGB ì±„ë„ì„ ìˆœíšŒ
        ssim_val = ssim(imgA[:,:,i], imgB[:,:,i], win_size=win_size, data_range=imgB[:,:,i].max() - imgB[:,:,i].min())
        mse_val = mean_squared_error(imgA[:,:,i], imgB[:,:,i])
        ssim_total += ssim_val
        mse_total += mse_val
    return ssim_total / 3, mse_total / 3  # í‰ê· ê°’ ë°˜í™˜

ssim12, mse12 = calculate_metrics(img1, img2)
ssim13, mse13 = calculate_metrics(img1, img3)
ssim14, mse14 = calculate_metrics(img1, img4)


# ì‹œê°í™”
fig, axes = plt.subplots(nrows=1, ncols=4, figsize=(20, 4), sharex=True, sharey=True)
ax = axes.ravel()

ax[0].imshow(img1)
ax[0].set_xlabel('Original Image')
ax[0].set_title('original')

ax[1].imshow(img2)
ax[1].set_xlabel(f'MSE: {mse12:.2f}, SSIM: {ssim12:.2f}')
ax[1].set_title('msdmpd')

ax[2].imshow(img3)
ax[2].set_xlabel(f'MSE: {mse13:.2f}, SSIM: {ssim13:.2f}')
ax[2].set_title('medmpdsnake')


ax[3].imshow(img4)
ax[3].set_xlabel(f'MSE: {mse14:.2f}, SSIM: {ssim14:.2f}')
ax[3].set_title('mrdmpd')

plt.tight_layout()
plt.show()
```

ì´ìƒìœ¼ë¡œ SSIM í¬ìŠ¤íŒ…ì„ ë§ˆì¹˜ê² ìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤ğŸ˜ğŸ˜