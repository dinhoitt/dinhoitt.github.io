---
layout: post
title:  "HiFi-GAN 이란?"
date:   2024-02-23T14:08:52+09:00
author: DINHO
categories:
  - 인공지능-분야-공부
  - 논문-리뷰
cover:  "/assets/post/hifigan.png"
---

오늘 주제는 HiFi GAN입니다. HiFi는 high-fidelity의 줄임말로 "음향에서 원음과 원화에 충실한 재현"의 뜻을 갖고 있습니다. 오늘은 다음 논문의 내용을 리뷰하고 정리하여 HiFi GAN에 대하여 설명해보겠습니다. _Kong, J., Kim, J., & Bae, J. (2020). Hifi-gan: Generative adversarial networks for efficient and high fidelity speech synthesis. Advances in Neural Information Processing Systems, 33, 17022-17033._

논문에서는 AR이나 플로우 기반 모델보다 더 높은 계산 효율성과 샘플 품질을 모두 달성하는 HiFi-GAN을 제안했습니다. 음성 오디오는 다양한 주기를 갖는 정현파 신호로 구성되므로 주기적인 패턴을 모델링하는 것이 사실적인 음성 오디오를 생성하는 데 중요합니다. 따라서 논문에서는 원시 파형의 특정 주기 부분만 얻는 작은 하위 판별자로 구성된 판별자를 제안했습니다. 이 구조는 사실적인 음성 오디오를 성공적으로 합성하는 모델의 기반입니다. 판별자를 위한 오디오의 서로 다른 부분을 추출하면서 다양한 길이의 패턴을 각각 관찰하는 여러 잔차 블록을 병렬로 배치하는 모듈을 설계하고 이를 생성기에 적용합니다. 그럼 본격적으로 개념과 이론들에 대해 알아보겠습니다.

# Overview

HiFi GAN은 생성기(Generator) 1개와 판별기(Discriminator, 다중 스케일 및 다중 기간 판별기) 2개로 구성됩니다. 생성자와 판별자는 훈련 안정성과 모델 성능을 향상시키기 위해 두 가지 추가 손실과 함께 대립적으로 훈련됩니다.

# Generator

생성기의 전체적인 내용은 다음과 같습니다.

생성기(Generator)는 fully convolutional neural network입니다. 입력으로는 멜-스펙트로그램을 사용하고 출력 시퀀스의 길이가 원시 파형의 시간 해상도와 일치할 때까지 전치된 컨볼루션(transposed convolutions)을 통해 업샘플링합니다. 모든 전치된 컨볼루션 뒤에는 다중 수용 필드 융합(Multi-receptive Field Fusion, MRF) 모듈이 뒤따릅니다. 

<img src="/assets/post/hifi generator.png">
이미지 출처: 논문 그림1

그림1은 생성기의 구조를 보여줍니다. 이전 연구(Mathieu et al., 2015, Isola et al., 2017, Kumar et al., 2019)에서와 같이, 생성기에서는 노이즈가 추가 입력으로 제공되지 않습니다.

생성기는 멜-스펙트로그램을 $$\vert ku \vert$$ 배까지 업샘플링 합니다. $$\vert ku \vert$$ 는 원시 파형의 시간적 해상도와 일치하는 시간입니다. MRF 모듈은 다양한 커널 크기와 팽창률의 잔차 블록 $$\vert kr \vert$$ 의 기능을 추가합니다. 

구조에 대해서 구체적으로 설명하겠습니다.

### Transposed Convolutions

__입력__ : 멜-스펙트로그램이 초기 입력으로 사용됩니다.
__전치된 컨볼루션__ : 네트워크는 일련의 전치 컨볼루션 레이어를 통해 멜-스팩트로그램을 업샘플링합니다. 이러한 레이어는 타겟 원시 파형의 해상도와 일치하도록 입력의 시간 해상도를 점진적으로 증가시킵니다.

  - 커널 크기 $$k_{u}[l]$$ : 전치된 컨볼루션 레이어의 필터 크기입니다.
  - Stride : Stride는 필터가 입력을 가로질러 이동하는 정도를 나타냅니다. 이 생성기의 경우 입력을 점진적으로 업샘플링하기 위해 커널 크기의 절반으로 설정됩니다.
  - 채널 : 각 전치 컨볼루션마다 출력 채널 수가 절반으로 줄어들기 때문에 출력 시퀀스의 길이가 늘어납니다.

### Multi-Receptive Field Fusion (MRF) Module

__MRF 모듈__ : 각 전치 컨볼루션 후에 출력은 MRF 모듈을 통해 전달됩니다. 이 모듈은 네트워크가 다양한 길이의 패턴을 관찰하고 결합하여 생성된 오디오의 풍부함과 다양성을 더할 수 있는 중요한 역할을 합니다. 
  - 잔차 블록 : 각 MRF 모듈은 여러 개의 잔차 블록으로 구성됩니다. 이러한 블록은 짧은 시간 패턴에서 긴 시간 패턴까지 광범위한 오디오 기능을 캡처하기 위해 다양한 커널 크기 $$k_r$$ 과 팽창률 $$D_r$$ 을 가지고 있습니다.

  요약하자면 MRF 모듈 내의 모든 잔차 블록의 출력을 합산하여 다양한 수용 필드 패턴을 병합합니다.

### Residual Block Structure

__Residual Block__ : 
  - Dilated Convolution : 각 잔차 블록 내에는 파라미터 수를 크게 늘리지 않고도 수용 필드를 확장하는 데 도움이 되는 확장 컨볼루션 (Dilated Convolution) 레이어가 있습니다. 이를 통해 네트워크는 오디오 시퀀스에서 더 긴 종속성(dependencies)을 캡처할 수 있습니다.
  - Leaky ReLU : 활성화 함수로 Leaky ReLU 함수가 적용됩니다. 이 비선형 활성화 함수는 훈련 중에 그래디언트 흐름을 유지하는 데 도움이 되며 dying ReLU (ReLU 소멸)을 방지하는 장점이 있습니다. (ReLU는 읍수 입력에 대해 0을 출력하고, Leaky ReLU는 음수 입력에 대해 0.01을 곱하기 때문에 대부분 모델에서는 연산 속도를 빠르게 하기 위해 ReLU를 적용합니다. 하지만 이 모델에서는 속도보다 ReLU소멸을 방지하는 데 초점을 둔 것 같습니다. 개인적인 의견입니다. 😉😉)

### Adjustable Parameters

__Adjustable Parameters__ : 생성기 구조는 유연성을 염두에 두고 설계되어 숨겨진 차원 $$h_u$$ , 커널 크기 ( 전치된 컨볼루션의 경우 $$k_u$$ $$k_r$$ ) 및 팽창율 ( $$D_R$$ )을 조정할 수 있습니다. 이를 통해 응용 분야의 특정 요구 사항에 따라 합성 효율성과 샘플 품질 간 균형을 유지할 수 있습니다. 

----------------------------

# Discriminator

장기적인 종속성(dependencies)을 식별하는 것은 사실적인 음성 오디오를 모델링하는 데 핵심입니다. 예를 들어, 음소 지속 시간이 100ms보다 길 수 있으므로 원시 파형에서 2,200 개 이상의 인접 샘플 간 높은 상관 관계가 나타날 수 있습니다. 이 문제는 이전 연구(Donahue et al., 2018)에서 생성기와 판별기의 수용 필드를 증가시켜 해결되었습니다. 이 논문에서는 아직 해결되지 않은 또 다른 중요 문제에 초점을 맞추었습니다.

음성 오디오는 다양한 주기를 갖는 정현파 신호로 구성되므로 오디오 데이터의 기본이 되는 다양한 주기 패턴을 식별해야 합니다. 이를 위해 이 논문에서는 입력 오디오의 주기적 신호의 일부를 처리하는 여러 개의 서브 판별기로 구성된 MPD(Multi-Period Discriminator)를 제안했습니다. 또한, 연속 패턴과 장기적인 종속성(dependencies)을 캡처하기 위해 MelGAN(Kumar et al., 2019)에서 제안된 MSD(Multi-Scale Discriminator)를 사용하여 다양한 수준에서 오디오 샘플을 연속적으로 평가합니다. 이 논문에서는 MPD와 MSD가 주기적인 패턴을 포착하기 위해 간단한 실험을 수행했고 결과를 확인했습니다.

<img src="/assets/post/msd_mpd.png">
이미지 출처: 논문 표6.


